services:
  web:
    build: .
    container_name: project3-web
    expose:
      - "8000"  
    ports:  # ë°°í¬í• ë•ŒëŠ” ì œê±°
      - "8000:8000"   # âœ… ì™¸ë¶€ ì ‘ì†ì„ ìœ„í•´ ì¶”ê°€
    volumes:
      - .:/app
      - static_volume:/app/static
    env_file:
      - .env
    depends_on:
      #- db   # ë°°í¬í• ë•ŒëŠ” ì£¼ì„í•´ì œ
      - qdrant  # ğŸ‘ˆ Qdrant ë¨¼ì € ëœ¨ê²Œ
    restart: unless-stopped

  db:
    image: postgres:16
    container_name: project3-db
    environment:
      - POSTGRES_DB=${POSTGRES_DB}
      - POSTGRES_USER=${POSTGRES_USER}
      - POSTGRES_PASSWORD=${POSTGRES_PASSWORD}
    volumes:
      - postgres_data:/var/lib/postgresql/data
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:latest
    container_name: project3-qdrant
    #ports:   # ë°°í¬í•  ë•ŒëŠ” ì£¼ì„ì œê±°
    #  - "6333:6333"
    #  - "6334:6334"
    volumes:
      - qdrant_data:/qdrant/storage
    restart: unless-stopped

  nginx:
    image: nginx:latest
    container_name: project3-nginx
    ports:
      - "80:80"
    volumes:
      - ./nginx.conf:/etc/nginx/conf.d/default.conf
      - static_volume:/app/static
    depends_on:
      - web

volumes:
  static_volume: {}
  postgres_data: {}
  qdrant_data: {}  # ğŸ‘ˆ Qdrant ë°ì´í„°ê°€ ì—¬ê¸° ë‚¨ìŒ
